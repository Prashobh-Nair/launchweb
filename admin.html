<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission Control - Admin</title>
    <link rel="stylesheet" href="css/style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Orbitron:wght@500;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            padding-top: 100px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: var(--glass-bg);
            padding: 40px;
            border-radius: 15px;
            border: 1px solid var(--glass-border);
            text-align: center;
        }

        .login-container input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            color: #fff;
            border-radius: 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
            background: var(--glass-bg);
            border-radius: 10px;
            overflow: hidden;
        }

        th,
        td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--glass-border);
        }

        th {
            background: rgba(125, 0, 247, 0.2);
            color: var(--primary-color);
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>

    <nav class="navbar">
        <a href="index.html" class="logo">LaunchWeb.</a>
    </nav>

    <div id="loginSection" class="login-container">
        <h2>Enter Access Code</h2>
        <input type="password" id="password" placeholder="Password">
        <button class="btn" onclick="checkPassword()">Unlock</button>
        <p id="errorMsg" style="color: #ff0050; margin-top: 10px;"></p>
    </div>

    <div id="dashboardSection" class="container hidden">
        <h1>Incoming Transmissions</h1>
        <button class="btn" onclick="fetchMessages()">Refresh Data</button>

        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Details</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="messagesTable">
                <!-- Messages will load here -->
            </tbody>
        </table>
    </div>

    <script>
        function checkPassword() {
            const pass = document.getElementById('password').value;
            // Simple client-side check. In a real app, this should be server-side.
            // Password is 'launchCode'
            if (pass === 'launchCode') {
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('dashboardSection').classList.remove('hidden');
                fetchMessages();
            } else {
                document.getElementById('errorMsg').innerText = 'Access Denied.';
            }
        }

        async function fetchMessages() {
            try {
                // Changed from /api/messages to /api/contacts to match server.js
                const response = await fetch('http://launchweb-backend-production.up.railway.app/api/contacts');
                const messages = await response.json();

                const tbody = document.getElementById('messagesTable');
                tbody.innerHTML = '';

                // Add null check for messages
                if (!messages || !Array.isArray(messages)) {
                    console.error('Invalid response format');
                    return;
                }

                messages.reverse().forEach(msg => {
                    // Check for invalid date
                    const dateObj = new Date(msg.date);
                    const date = !isNaN(dateObj.getTime()) 
                        ? dateObj.toLocaleDateString() + ' ' + dateObj.toLocaleTimeString()
                        : (msg.time || 'Unknown Date'); // Fallback to old 'time' field if 'date' is missing

                    const row = `
                        <tr>
                            <td>${date}</td>
                            <td>${msg.name}<br><small style="opacity:0.7">${msg.businessName || ''}</small></td>
                            <td>${msg.email}<br><small style="opacity:0.7">${msg.phone || ''}</small></td>
                            <td>Contact Request</td>
                            <td>
                                <button onclick="deleteMessage('${msg.id}')" style="background: #ff0050; border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Delete</button>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            } catch (error) {
                console.error('Error fetching messages:', error);
            }
        }

        async function deleteMessage(id) {
            if (!confirm('Are you sure you want to delete this specific request?')) return;

            try {
                // Changed to /api/contacts and used correct ID
                const response = await fetch(`http://launchweb-backend-production.up.railway.app/api/contacts/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();
                if (result.success) {
                    fetchMessages(); // Refresh the list
                } else {
                    alert('Failed to delete: ' + (result.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error deleting message:', error);
                alert('Error deleting message');
            }
        }
    </script>
</body>


</html>

